#!/bin/bash

set -euo pipefail
shopt -s inherit_errexit

addkalikey () {
  sudo apt-key adv --keyserver pool.sks-keyservers.net --recv-keys ED444FF07D8D0BF6
}

addrepo "deb http://http.kali.org/kali kali-rolling main contrib non-free" addkalikey


log "Updating package lists..."
sudo apt update
log "Installing packages..."
aptinst seclists curl enum4linux gobuster nbtscan nikto nmap onesixtyone\
  oscanner smbclient smbmap smtp-user-enum snmp sslscan sipvicious tnscmd10g whatweb\
  wkhtmltopdf gdb

log "Installing autorecon..."
pipx upgrade git+https://github.com/Tib3rius/AutoRecon.git

log "Installing pwncat..."
if [ ! -d ~/.pwncat-env ]; then
  python -m venv ~/.pwncat-env
fi
# Activate venv
source ~/.pwncat-env/bin/activate

# Install/upgrade pwncat
pip install --upgrade git+https://github.com/calebstewart/pwncat.git

if [ ! -f ~/.local/bin/pcat ]; then
  # Make it available even when venv isn't activated
  ln -s ~/.pwncat-env/bin/pwncat $HOME/.local/bin/pcat
fi

deactivate


# Sadly, version has to be bumped manually, so check for install
if [ ! -d ~/.ghidra ]; then
  log "Installing ghidra..."
  wget -O ~/Downloads/ghidra.zip https://ghidra-sre.org/ghidra_9.2_PUBLIC_20201113.zip
  ldir=$(pwd)
  cd ~
  unzip ~/Downloads/ghidra.zip
  mv ghidra* .ghidra
  rm ~/Downloads/ghidra.zip
  log "Ghidra installed to ~/.ghidra"
  cd $ldir
else
  log "Ghidra already installed."
fi


if [ ! -f ~/.gdbinit-gef.py ]; then
  log "Installing GEF..."
  wget -q -O- https://github.com/hugsy/gef/raw/master/scripts/gef.sh | sh
fi
log "Updating GEF..."
python ~/.gdbinit-gef.py --update
